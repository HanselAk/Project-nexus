<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PROJECT NEXUS | AI Ideation Engine</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --cyber-primary: #00ff88;
      --cyber-secondary: #00d4ff;
      --cyber-danger: #ff0066;
      --cyber-warning: #ffaa00;
      --bg-primary: #0a0e17;
      --bg-secondary: #13161f;
      --bg-tertiary: #1a1f2e;
      --bg-card: rgba(26, 31, 46, 0.8);
      --text-primary: #ffffff;
      --text-secondary: #8b92a8;
      --border: rgba(0, 255, 136, 0.2);
      --glow: rgba(0, 255, 136, 0.5);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-image:
        linear-gradient(rgba(0, 255, 136, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 136, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridScroll 20s linear infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes gridScroll {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    body::after {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(to bottom, transparent 50%, rgba(0, 255, 136, 0.02) 50%);
      background-size: 100% 4px;
      animation: scanline 8s linear infinite;
      pointer-events: none;
      z-index: 100;
    }

    @keyframes scanline {
      0% { transform: translateY(0); }
      100% { transform: translateY(100vh); }
    }

    .particles {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 2px; height: 2px;
      background: var(--cyber-primary);
      box-shadow: 0 0 10px var(--cyber-primary);
      animation: float 10s infinite;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
      50% { opacity: 1; }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
      z-index: 2;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
      animation: glitchIn 1s ease;
    }

    @keyframes glitchIn {
      0% { opacity: 0; transform: translateX(-100px); }
      20% { transform: translateX(10px); }
      40% { transform: translateX(-5px); }
      60% { transform: translateX(3px); }
      80% { transform: translateX(-1px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(2.5rem, 6vw, 4.5rem);
      font-weight: 900;
      color: var(--cyber-primary);
      text-shadow: 0 0 10px var(--cyber-primary), 0 0 20px var(--cyber-primary), 0 0 40px var(--cyber-primary);
      letter-spacing: 4px;
      margin-bottom: 1rem;
      animation: pulse 2s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { text-shadow: 0 0 10px var(--cyber-primary), 0 0 20px var(--cyber-primary); }
      50% { text-shadow: 0 0 20px var(--cyber-primary), 0 0 40px var(--cyber-primary), 0 0 60px var(--cyber-primary); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 3px;
      font-weight: 500;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 0;
      padding: 2.5rem;
      position: relative;
      backdrop-filter: blur(10px);
      animation: slideIn 0.6s ease;
      animation-fill-mode: both;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card:nth-child(1) { animation-delay: 0.1s; }
    .card:nth-child(2) { animation-delay: 0.2s; }
    .card:nth-child(3) { animation-delay: 0.3s; }

    .card::before,
    .card::after {
      content: '';
      position: absolute;
      width: 20px; height: 20px;
      border: 2px solid var(--cyber-primary);
    }

    .card::before {
      top: -1px; left: -1px;
      border-right: none;
      border-bottom: none;
    }

    .card::after {
      bottom: -1px; right: -1px;
      border-left: none;
      border-top: none;
    }

    h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--cyber-primary);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 700;
      position: relative;
      padding-bottom: 0.5rem;
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0;
      width: 60px; height: 2px;
      background: var(--cyber-primary);
      box-shadow: 0 0 10px var(--cyber-primary);
    }

    .form-section {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border);
    }

    .form-section:last-child { border-bottom: none; }

    .section-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      color: var(--cyber-secondary);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .form-group { margin-bottom: 1.5rem; }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--cyber-primary);
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .label-hint {
      color: var(--text-secondary);
      font-size: 0.8rem;
      text-transform: none;
      font-weight: 400;
      margin-top: 0.25rem;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 1rem;
      background: rgba(19, 22, 31, 0.8);
      border: 1px solid var(--border);
      color: var(--text-primary);
      font-family: 'Rajdhani', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--cyber-primary);
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
      background: rgba(19, 22, 31, 1);
    }

    textarea { resize: vertical; min-height: 100px; }
    textarea.large { min-height: 150px; }

    .tech-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .tech-item { position: relative; }
    .tech-item input[type="checkbox"] { position: absolute; opacity: 0; }

    .tech-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem 0.5rem;
      background: rgba(19, 22, 31, 0.8);
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
    }

    .tech-label::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
      transition: left 0.5s;
    }

    .tech-item:hover .tech-label::before { left: 100%; }

    .tech-item input:checked + .tech-label {
      background: rgba(0, 255, 136, 0.2);
      border-color: var(--cyber-primary);
      color: var(--cyber-primary);
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3), inset 0 0 20px rgba(0, 255, 136, 0.1);
    }

    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .btn-primary {
      width: 100%;
      padding: 1.5rem 2rem;
      background: var(--cyber-primary);
      color: var(--bg-primary);
      border: 2px solid var(--cyber-primary);
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 3px;
      position: relative;
      overflow: hidden;
      margin-top: 2rem;
    }

    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .loading { display: none; text-align: center; padding: 4rem 2rem; }
    .loading.active { display: block; }

    .loading-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      color: var(--cyber-primary);
      text-transform: uppercase;
      letter-spacing: 3px;
      animation: textGlow 1.5s ease infinite;
    }

    @keyframes textGlow {
      0%, 100% { opacity: 0.7; text-shadow: 0 0 10px var(--cyber-primary); }
      50% { opacity: 1; text-shadow: 0 0 20px var(--cyber-primary), 0 0 30px var(--cyber-primary); }
    }

    .results { display: none; }
    .results.active { display: block; }

    .project-grid { display: grid; gap: 1.5rem; }

    .project-card {
      background: rgba(19, 22, 31, 0.9);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .project-card:hover {
      border-color: var(--cyber-primary);
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.2);
      transform: translateY(-3px);
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
      gap: 1rem;
    }

    .project-header-left { flex: 1; }

    .project-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: var(--cyber-primary);
      color: var(--bg-primary);
      border-radius: 50%;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 0.75rem;
    }

    .project-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.25rem;
      color: var(--text-primary);
      font-weight: 700;
      margin-bottom: 0.75rem;
      line-height: 1.3;
    }

    .project-section h4 {
      font-family: 'Rajdhani', sans-serif;
      color: var(--cyber-primary);
      font-size: 0.85rem;
      margin-bottom: 0.35rem;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .project-section h4::before {
      content: '';
      width: 4px;
      height: 4px;
      background: var(--cyber-primary);
      display: inline-block;
      border-radius: 50%;
    }

    .project-description {
      color: var(--text-secondary);
      line-height: 1.7;
      font-size: 0.95rem;
    }

    .project-list {
      color: var(--text-secondary);
      line-height: 1.7;
      font-size: 0.95rem;
      padding-left: 1.2rem;
    }

    .project-list li { margin-bottom: 0.25rem; }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-top: 0.9rem;
      padding-top: 0.9rem;
      border-top: 1px solid var(--border);
    }

    .info-item { display: flex; align-items: center; gap: 0.5rem; }
    .info-label { font-size: 0.8rem; color: var(--text-secondary); font-weight: 600; }
    .info-value { font-size: 0.85rem; color: var(--cyber-secondary); font-weight: 600; }

    .project-image-container {
      width: 100%;
      max-width: 240px;
      height: 160px;
      border: 2px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
      background: rgba(19, 22, 31, 0.6);
      flex-shrink: 0;
    }

    .project-image { width: 100%; height: 100%; object-fit: cover; }

    .image-loading {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: var(--cyber-primary);
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      font-size: 0.75rem;
    }

    .image-loading-spinner {
      width: 30px;
      height: 30px;
      border: 2px solid var(--border);
      border-top-color: var(--cyber-primary);
      border-radius: 50%;
      margin: 0 auto 0.5rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 768px) {
      .container { padding: 1rem; }
      .card { padding: 1.5rem; }
      .tech-grid { grid-template-columns: 1fr; }
      .two-column { grid-template-columns: 1fr; }
      .logo { font-size: 2rem; }
      .project-header { flex-direction: column; }
      .project-image-container { max-width: 100%; }
    }
  </style>
</head>

<body>
  <div class="particles" id="particles"></div>

  <div class="container">
    <header>
      <div class="logo">PROJECT NEXUS</div>
      <p class="subtitle">Advanced AI-Powered Ideation Engine</p>
    </header>

    <div class="main-grid">
      <div class="card">
        <h2>‚öô Configuration</h2>
        <div class="form-group">
          <label for="model">AI Model</label>
          <select id="model">
            <option value="gpt-4.1-mini" selected>GPT-4.1 Mini (Recommended)</option>
            <option value="gpt-4.1">GPT-4.1</option>
            <option value="gpt-4o-mini">GPT-4o Mini</option>
          </select>
        </div>
      </div>

      <div class="card">
        <h2>üìù Project Parameters</h2>

        <div class="form-section">
          <div class="section-title">üéØ Problem & Context</div>

          <div class="form-group">
            <label for="problem">
              Problem Statement
              <div class="label-hint">What problem are you trying to solve?</div>
            </label>
            <textarea id="problem" class="large" placeholder="Describe the problem in detail..."></textarea>
          </div>

          <div class="form-group">
            <label for="targetAudience">
              Target Audience
              <div class="label-hint">Who will use this solution?</div>
            </label>
            <input type="text" id="targetAudience" placeholder="e.g., Students, Parents, Teachers...">
          </div>

          <div class="form-group">
            <label for="industryDomain">
              Industry/Domain
              <div class="label-hint">What field or sector does this apply to?</div>
            </label>
            <select id="industryDomain">
              <option value="">Any Domain</option>
              <option value="Education">Education</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Finance">Finance</option>
              <option value="Social Impact">Social Impact</option>
              <option value="Environmental">Environmental</option>
              <option value="Smart Cities">Smart Cities</option>
              <option value="Gaming">Gaming</option>
              <option value="E-commerce">E-commerce</option>
              <option value="Manufacturing">Manufacturing</option>
              <option value="Transportation">Transportation</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Agriculture">Agriculture</option>
            </select>
          </div>
        </div>

        <div class="form-section">
          <div class="section-title">üíª Technical Specifications</div>

          <div class="form-group">
            <label>Preferred Technologies</label>
            <div class="tech-grid">
              <div class="tech-item"><input type="checkbox" id="tech-ai" value="AI/ML"><label for="tech-ai" class="tech-label">AI/ML</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-iot" value="IoT"><label for="tech-iot" class="tech-label">IoT</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-mobile" value="Mobile"><label for="tech-mobile" class="tech-label">Mobile</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-web" value="Web"><label for="tech-web" class="tech-label">Web</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-cloud" value="Cloud"><label for="tech-cloud" class="tech-label">Cloud</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-embedded" value="Embedded"><label for="tech-embedded" class="tech-label">Embedded</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-cv" value="Computer Vision"><label for="tech-cv" class="tech-label">Computer Vision</label></div>
              <div class="tech-item"><input type="checkbox" id="tech-nlp" value="NLP"><label for="tech-nlp" class="tech-label">NLP</label></div>
            </div>
          </div>

          <div class="form-group">
            <label for="techStack">
              Specific Tech Stack (Optional)
              <div class="label-hint">Any frameworks / languages you want?</div>
            </label>
            <input type="text" id="techStack" placeholder="e.g., React, Python, AWS, STM32...">
          </div>

          <div class="form-group">
            <label>Platform Target</label>
            <div class="two-column">
              <select id="platform">
                <option value="Any" selected>Any</option>
                <option value="Web">Web</option>
                <option value="Mobile">Mobile</option>
                <option value="Desktop">Desktop</option>
                <option value="Hardware">Hardware</option>
                <option value="Hybrid">Hybrid</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="section-title">üé≤ Output Configuration</div>

          <div class="two-column">
            <div class="form-group">
              <label for="count">Number of Ideas</label>
              <select id="count">
                <option value="3" selected>3 Ideas</option>
                <option value="4">4 Ideas</option>
                <option value="5">5 Ideas</option>
              </select>
            </div>

            <div class="form-group">
              <label for="detailLevel">Detail Level</label>
              <select id="detailLevel">
                <option value="brief">Brief</option>
                <option value="moderate" selected>Moderate</option>
                <option value="comprehensive">Comprehensive</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="includeExtras" checked style="width:auto; display:inline; margin-right:0.5rem;">
              Include roadmap + risks + metrics
            </label>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="generateImages" style="width:auto; display:inline; margin-right:0.5rem;">
              Generate AI images for each idea (slower)
            </label>
          </div>
        </div>

        <button class="btn-primary" id="generateBtn"><span>‚ö° GENERATE PROJECT IDEAS</span></button>
      </div>

      <div class="loading" id="loading">
        <div class="loading-text">Analyzing Parameters...</div>
      </div>

      <div class="results" id="results"></div>
    </div>
  </div>

  <script>
    // Particle System
    function createParticles() {
      const container = document.getElementById('particles');
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDuration = (Math.random() * 10 + 5) + 's';
        particle.style.animationDelay = Math.random() * 5 + 's';
        container.appendChild(particle);
      }
    }
    createParticles();

    function safeSlice(text, n) {
      const t = (text || "").trim();
      if (!t) return "";
      return t.length > n ? (t.slice(0, n).trim() + "‚Ä¶") : t;
    }

    function pickMatch(project, label) {
      // matches "**Label**: ..." up to next "**"
      const re = new RegExp(`\\*\\*${label}[:\\s]*\\*\\*[:\\s]*(.+?)(?=\\n\\*\\*|\\n\\d+\\.\\s*\\*\\*|$)`, 'is');
      const m = project.match(re);
      return m ? m[1].trim() : "";
    }

    function parseBullets(block, maxItems) {
      const t = (block || "").trim();
      if (!t) return [];
      // split on lines that start with -, ‚Ä¢, *
      const lines = t.split(/\n/).map(x => x.trim());
      const items = [];
      for (const line of lines) {
        const cleaned = line.replace(/^[-‚Ä¢*]\s*/, "").trim();
        if (cleaned.length > 2) items.push(cleaned);
      }
      // fallback: comma split
      if (items.length === 0) {
        t.split(/,/).map(x => x.trim()).filter(x => x.length > 2).forEach(x => items.push(x));
      }
      return items.slice(0, maxItems);
    }

    async function callNetlifyFunction(path, payload) {
      const response = await fetch(path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const raw = await response.text();

      if (!response.ok) {
        let msg = raw;
        try {
          const j = JSON.parse(raw);
          msg = (typeof j?.error === 'string' && j.error) || j?.error?.message || j?.message || raw;
        } catch (_) {}
        throw new Error(`API Error ${response.status}: ${msg}`);
      }

      let data;
      try { data = JSON.parse(raw); }
      catch { throw new Error(`Server returned non-JSON: ${raw.slice(0, 120)}...`); }

      return data;
    }

    document.getElementById('generateBtn').addEventListener('click', async function () {
      const params = {
        model: document.getElementById('model').value,
        problem: document.getElementById('problem').value,
        targetAudience: document.getElementById('targetAudience').value,
        industryDomain: document.getElementById('industryDomain').value,
        techStack: document.getElementById('techStack').value,
        platform: document.getElementById('platform').value,
        count: document.getElementById('count').value,
        detailLevel: document.getElementById('detailLevel').value,
        includeExtras: document.getElementById('includeExtras').checked,
        generateImages: document.getElementById('generateImages').checked
      };

      const technologies = [];
      document.querySelectorAll('.tech-item input[type="checkbox"]:checked').forEach(cb => technologies.push(cb.value));

      // Prompt tuned to your compact layout
      let prompt = `Generate ${params.count} senior project ideas.\n`;
      prompt += `Format STRICTLY like this for each idea (use these exact headings):\n`;
      prompt += `**Title**: ...\n`;
      prompt += `**Description**: (2-3 sentences)\n`;
      prompt += `**Key Components**: (3-6 bullet points)\n`;
      prompt += `**Technologies**: (bullet list or comma list)\n`;
      prompt += `**Challenges**: (2-4 bullets)\n`;
      prompt += `**Est. Cost**: (example: $50-$150)\n`;
      prompt += `**Timeline**: (example: 8-10 weeks)\n`;
      prompt += `**Market Appeal**: (1-2 sentences)\n`;
      prompt += `**Unique Value**: (1-2 sentences)\n`;
      if (params.generateImages) prompt += `**Image Prompt**: (a DALL¬∑E style prompt for a concept image)\n`;
      prompt += `\nNow tailor to these parameters:\n`;
      if (params.problem) prompt += `Problem: ${params.problem}\n`;
      if (params.targetAudience) prompt += `Target Audience: ${params.targetAudience}\n`;
      if (params.industryDomain) prompt += `Domain: ${params.industryDomain}\n`;
      if (technologies.length) prompt += `Preferred Technologies: ${technologies.join(', ')}\n`;
      if (params.techStack) prompt += `Preferred Stack: ${params.techStack}\n`;
      prompt += `Platform: ${params.platform}\n`;
      prompt += `Detail Level: ${params.detailLevel}\n`;
      prompt += `Include Extras: ${params.includeExtras}\n`;

      this.disabled = true;
      document.getElementById('loading').classList.add('active');
      document.getElementById('results').classList.remove('active');

      try {
        const data = await callNetlifyFunction('/.netlify/functions/generate-ideas', {
          model: params.model,
          prompt
        });

        const content = (data.ideasText || "").trim();
        if (!content) throw new Error("API returned empty ideasText");

        displayResults(content, technologies, params);
      } catch (error) {
        alert('‚ö†Ô∏è ERROR: ' + error.message);
        console.error(error);
      } finally {
        document.getElementById('loading').classList.remove('active');
        this.disabled = false;
      }
    });

    function displayResults(content, technologies, params) {
      const resultsDiv = document.getElementById('results');

      // Split by Title blocks (no Project 1/2/3 headings)
      const chunks = content
        .split(/(?=\*\*Title\*\*[:\s])/i)
        .map(s => s.trim())
        .filter(s => s.length > 80);

      let html = '<div class="card"><h2>üéØ Generated Project Ideas</h2><div class="project-grid">';

      chunks.forEach((project, index) => {
        const title = pickMatch(project, "Title") || `Untitled Project`;
        const desc = pickMatch(project, "Description") || pickMatch(project, "Problem") || "";
        const keyComponents = pickMatch(project, "Key Components") || pickMatch(project, "Key Features") || "";
        const tech = pickMatch(project, "Technologies") || pickMatch(project, "Technology Stack") || "";
        const challenges = pickMatch(project, "Challenges") || pickMatch(project, "Challenges & Risks") || "";
        const estCost = pickMatch(project, "Est\\. Cost") || pickMatch(project, "Estimated Cost") || "";
        const timeline = pickMatch(project, "Timeline") || "";
        const marketAppeal = pickMatch(project, "Market Appeal") || "";
        const uniqueValue = pickMatch(project, "Unique Value") || pickMatch(project, "Competitive Advantage") || "";
        const imagePrompt = pickMatch(project, "Image Prompt") || "";

        const keyList = parseBullets(keyComponents, 6);
        const techList = parseBullets(tech, 6);
        const challengeList = parseBullets(challenges, 5);

        html += `
          <div class="project-card">
            <div class="project-header">
              <div class="project-header-left">
                <div class="project-number">${index + 1}</div>
                <h3 class="project-title">${title}</h3>

                <div class="project-content">
                  ${desc ? `
                    <div class="project-section">
                      <h4>Description</h4>
                      <p class="project-description">${safeSlice(desc, 320)}</p>
                    </div>` : ''}

                  ${keyList.length ? `
                    <div class="project-section">
                      <h4>Key Components</h4>
                      <ul class="project-list">${keyList.map(x => `<li>${x}</li>`).join('')}</ul>
                    </div>` : ''}

                  ${techList.length ? `
                    <div class="project-section">
                      <h4>Technologies</h4>
                      <ul class="project-list">${techList.map(x => `<li>${x}</li>`).join('')}</ul>
                    </div>` : ''}

                  ${challengeList.length ? `
                    <div class="project-section">
                      <h4>Challenges</h4>
                      <ul class="project-list">${challengeList.map(x => `<li>${x}</li>`).join('')}</ul>
                    </div>` : ''}

                  ${(estCost || timeline) ? `
                    <div class="info-grid">
                      <div class="info-item">
                        <span class="info-label">Est. Cost</span>
                        <span class="info-value">${estCost || "‚Äî"}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Timeline</span>
                        <span class="info-value">${timeline || "‚Äî"}</span>
                      </div>
                    </div>` : ''}

                  ${marketAppeal ? `
                    <div class="project-section" style="margin-top:1rem;">
                      <h4>Market Appeal</h4>
                      <p class="project-description">${safeSlice(marketAppeal, 260)}</p>
                    </div>` : ''}

                  ${uniqueValue ? `
                    <div class="project-section">
                      <h4>Unique Value</h4>
                      <p class="project-description">${safeSlice(uniqueValue, 260)}</p>
                    </div>` : ''}
                </div>

                ${technologies.length ? `
                  <div class="project-tags">
                    ${technologies.slice(0, 6).map(t => `<span class="tag">${t}</span>`).join('')}
                  </div>` : ''}
              </div>

              ${params.generateImages ? `
                <div class="project-image-container" id="img-container-${index}">
                  <div class="image-loading">
                    <div class="image-loading-spinner"></div>
                    <div>Generating...</div>
                  </div>
                </div>` : ''}
            </div>
          </div>
        `;

        if (params.generateImages) {
          const promptForImage =
            imagePrompt ||
            `A clean modern tech concept illustration for: ${title}. Dark futuristic UI. Neon green accents.`;
          setTimeout(() => generateProjectImage(index, promptForImage, title), index * 1200);
        }
      });

      html += '</div></div>';
      resultsDiv.innerHTML = html;
      resultsDiv.classList.add('active');
      resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    async function generateProjectImage(index, imagePrompt, projectTitle) {
      const container = document.getElementById(`img-container-${index}`);
      if (!container) return;

      try {
        const data = await callNetlifyFunction('/.netlify/functions/generate-image', {
          prompt: imagePrompt
        });

        if (!data.imageUrl) throw new Error("No imageUrl returned");

        container.innerHTML = `<img src="${data.imageUrl}" alt="${projectTitle}" class="project-image">`;
      } catch (err) {
        console.error(err);
        container.innerHTML = `
          <div class="image-loading">
            <div style="color: var(--cyber-danger);">‚ö† Image failed</div>
            <div style="font-size: 0.8rem; margin-top: 0.5rem;">${err.message}</div>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
